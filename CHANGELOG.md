# Changelog - MedConnect

Todos los cambios notables de este proyecto ser√°n documentados en este archivo.

El formato est√° basado en [Keep a Changelog](https://keepachangelog.com/es-ES/1.0.0/),
y este proyecto adhiere a [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.3.0] - 2024-12-28

### ü§ñ Copilot Health - IA Cl√≠nica Asistiva
- **Nuevo**: M√≥dulo completo de IA cl√≠nica asistiva integrado
- **Nuevo**: An√°lisis autom√°tico del motivo de consulta con detecci√≥n de especialidad
- **Nuevo**: Evaluaci√≥n inteligente de antecedentes con detecci√≥n de banderas rojas
- **Nuevo**: Sugerencias de planes de tratamiento basados en evidencia cient√≠fica
- **Nuevo**: Interfaz web dedicada para profesionales en `/copilot-health`
- **Nuevo**: 4 endpoints de API para integraci√≥n con sistemas externos
- **Nuevo**: Soporte para 8 especialidades m√©dicas principales
- **Nuevo**: Referencias bibliogr√°ficas con DOI y niveles de evidencia
- **Nuevo**: Aclaraci√≥n legal autom√°tica en todas las sugerencias
- **Nuevo**: Sistema de pruebas automatizadas para validaci√≥n

### üéØ Funcionalidades de Copilot Health
- **An√°lisis del Motivo**: Detecci√≥n autom√°tica de especialidad, categor√≠a y urgencia
- **Evaluaci√≥n Inteligente**: Detecci√≥n de banderas rojas y omisiones comunes
- **Planes de Tratamiento**: Sugerencias con evidencia cient√≠fica y contraindicaciones
- **An√°lisis Completo**: Resumen integral con todas las funcionalidades

### üîß Integraci√≥n T√©cnica
- **M√≥dulo Principal**: `copilot_health.py` con clase CopilotHealth
- **API Endpoints**: 4 endpoints REST para integraci√≥n
- **Interfaz Web**: Plantilla `copilot_health.html` con dise√±o moderno
- **Navegaci√≥n**: Enlace en panel de profesionales
- **Pruebas**: Script `test_copilot_health.py` para validaci√≥n
- **Normalizaci√≥n Regional**: Funci√≥n `_normalizar_tipo_atencion()` con diccionario de sin√≥nimos
- **Pruebas Regionales**: Script `test_normalizacion_regional.py` para validar variaciones
- **Documentaci√≥n Regional**: `NORMALIZACION_REGIONAL_IA.md` con casos de uso y ejemplos

### üìä Especialidades Soportadas
- Traumatolog√≠a, Cardiolog√≠a, Neurolog√≠a, Gastroenterolog√≠a
- Neumolog√≠a, Dermatolog√≠a, Endocrinolog√≠a, Psiquiatr√≠a

### üåç Normalizaci√≥n Regional - Nuevas Capacidades
- **Nuevo**: Reconocimiento de sin√≥nimos y variaciones regionales de carreras de salud
- **Nuevo**: Sistema de normalizaci√≥n inteligente para diferentes contextos geogr√°ficos
- **Nuevo**: Soporte para terminolog√≠a local y familiar en cada regi√≥n
- **Nuevo**: Adaptaci√≥n autom√°tica a diferentes culturas y contextos m√©dicos

#### Variaciones Regionales Soportadas
- **Fisioterapia/Kinesiolog√≠a**: fisio, fisioterapeuta, kinesio, kinesi√≥logo, kinesiolog√≠a
- **Fonoaudiolog√≠a/Logopedia**: fono, logopeda, logopedia, terapia del habla, patolog√≠a del habla
- **Terapia Ocupacional/Ergoterapia**: t.o., to, ergoterapia, ergoterapeuta
- **Psicolog√≠a/Psicoterapia**: psico, psic√≥logo, psic√≥loga, psicoterapia, psicoterapeuta
- **Nutrici√≥n/Diet√©tica**: nutricionista, dietista, nutri√≥logo, diet√≥logo
- **Medicina General/Familiar**: m√©dico general, medicina familiar, m√©dico de familia, medicina primaria
- **Urgencia/Emergencia**: emergencia, urgencias, emergencias, m√©dico de urgencia

#### Beneficios de la Normalizaci√≥n Regional
- **Inclusi√≥n Global**: Soporte para diferentes contextos culturales y geogr√°ficos
- **Experiencia Familiar**: Reconocimiento de terminolog√≠a local y cotidiana
- **Precisi√≥n Mejorada**: Detecci√≥n m√°s robusta de especialidades m√©dicas
- **Adaptabilidad**: Sistema que se adapta a diferentes regiones autom√°ticamente

### üîÑ Integraci√≥n en Formulario de Atenciones
- **An√°lisis en Tiempo Real**: Al escribir el motivo de consulta, la IA analiza autom√°ticamente
- **Preguntas Sugeridas Integradas**: Aparecen autom√°ticamente en el campo de evaluaci√≥n
- **Sugerencias de Tratamiento**: Bot√≥n para generar opciones de tratamiento con evidencia
- **An√°lisis Completo**: Secci√≥n especial para an√°lisis integral de toda la informaci√≥n
- **Indicadores Visuales**: Badges y cards que muestran el estado de la IA
- **Funciones JavaScript**: Integraci√≥n completa con el flujo de trabajo existente

### üé® Mejoras de UX
- **Indicadores de IA**: Badges azules, verdes y amarillos para identificar funcionalidades de IA
- **Spinners de Carga**: Indicadores visuales durante el an√°lisis
- **Cards Informativos**: Secciones organizadas para mostrar resultados de IA
- **Botones de Acci√≥n**: Funciones para insertar sugerencias en los campos correspondientes
- **Notificaciones**: Feedback inmediato sobre el estado de las operaciones de IA

## [2.2.0] - 2024-12-28

### üöÄ Bot de Telegram - Mejoras Avanzadas
- **Nuevo**: 3 categor√≠as adicionales (recordatorio, cita_futura, seguimiento)
- **Expandido**: Categor√≠a medicamento con 19 palabras clave (+137%)
- **Expandido**: Categor√≠a examen con 20 palabras clave (+150%)
- **Nuevo**: Reconocimiento de medicamentos nuevos vs seguimiento de efectos
- **Nuevo**: Diferenciaci√≥n entre ex√°menes realizados y futuros
- **Nuevo**: Sistema de recordatorios inteligentes para medicamentos y citas
- **Nuevo**: Gesti√≥n de citas futuras con planificaci√≥n proactiva
- **Nuevo**: Seguimiento personalizado de tratamientos y evoluci√≥n
- **Mejorado**: Detecci√≥n de efectos secundarios y adherencia al tratamiento
- **Mejorado**: Reconocimiento de preparaci√≥n especial para ex√°menes

### üíä Medicamentos Avanzados
- **Frases reconocidas**: "Me recetaron un nuevo medicamento", "¬øC√≥mo va mi tratamiento?", "He notado efectos secundarios"
- **Capacidades**: Seguimiento de efectividad, detecci√≥n de reacciones, monitoreo de adherencia
- **Diferenciaci√≥n**: Medicamentos nuevos vs seguimiento de medicamentos existentes

### ü©∫ Ex√°menes Completos
- **Realizados**: "Ya me hice los ex√°menes", "Tengo resultados", "Salieron los an√°lisis"
- **Futuros**: "Tengo que hacerme", "Debo hacerme", "Tengo programada una ecograf√≠a"
- **Capacidades**: Registro de resultados, programaci√≥n de recordatorios, preparaci√≥n especial

### üîî Sistema de Recordatorios
- **Frases**: "Recordarme tomar las pastillas", "Necesito una alerta", "Programar aviso"
- **Tipos**: Medicamentos, citas m√©dicas, ex√°menes programados, renovaci√≥n de recetas

### üìÖ Citas Futuras
- **Frases**: "Quiero agendar una cita", "Programar cita con cardi√≥logo", "Reservar hora"
- **Funcionalidades**: Planificaci√≥n proactiva, organizaci√≥n de consultas futuras

### üìä Seguimiento Personalizado
- **Frases**: "¬øC√≥mo voy con mi diabetes?", "Evoluci√≥n de mi presi√≥n", "¬øEstoy mejorando?"
- **Capacidades**: Monitoreo continuo, evaluaci√≥n de progreso, tracking de par√°metros vitales

### üìà Estad√≠sticas Expandidas
- **Categor√≠as**: 11 tipos de intenciones (antes: 8)
- **Palabras clave**: 60+ t√©rminos reconocidos (antes: 30+)
- **Cobertura**: +200% en reconocimiento de intenciones
- **Precisi√≥n**: 71.4% en 35 frases de prueba avanzadas

### üìö Documentaci√≥n Nueva
- **BOT_MEJORAS_AVANZADAS.md**: Documentaci√≥n completa de 200+ l√≠neas
- **demo_mejoras_avanzadas.py**: Script de demostraci√≥n con 35 casos de prueba
- **bot_mejoras_avanzadas.py**: Archivo de especificaciones t√©cnicas

## [1.0.0] - 2024-12-19

### ‚ú® Agregado
- **Sistema completo de gesti√≥n m√©dica familiar**
- **Bot de Telegram inteligente** con interfaz de botones
- **Aplicaci√≥n web Flask** con autenticaci√≥n
- **Sistema de gesti√≥n familiar** con permisos granulares
- **Notificaciones autom√°ticas** a familiares autorizados
- **Recordatorios de medicamentos** y citas m√©dicas
- **Subida de archivos m√©dicos** (ex√°menes, recetas)
- **Base de datos en Google Sheets** sin costos adicionales
- **Sistema de conectividad robusta** con reintentos autom√°ticos
- **Supervisor de procesos** para el bot
- **Logs estructurados** con timestamps
- **Manejo de errores** comprehensivo

### ü§ñ Bot de Telegram
- Comandos principales: `/start`, `/help`, `/mi_info`, `/familiares`, `/notificaciones`
- Palabras clave: `menu`, `familiares`, `documentos`, `notificaciones`
- **Autorizaci√≥n de familiares** paso a paso
- **Gesti√≥n multi-usuario** fluida
- **Cambio entre usuarios** gestionados
- **Sistema de permisos**: Solo Ver, Ver y Editar, Control Total
- **Notificaciones en tiempo real** de actividad familiar
- **Recordatorios programables** con diferentes frecuencias

### üåê Aplicaci√≥n Web
- **Dashboard principal** responsivo
- **Autenticaci√≥n segura** con bcrypt
- **Gesti√≥n de perfiles** de usuario
- **Interfaz optimizada** para m√≥viles
- **P√°ginas especializadas** para pacientes y profesionales

### üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Sistema Familiar
- **Autorizaci√≥n granular** de familiares
- **Verificaci√≥n de permisos** en cada operaci√≥n
- **Logs de auditor√≠a** de acciones familiares
- **Notificaciones autom√°ticas** cuando usuario principal usa el bot
- **Avisos de nuevas consultas** m√©dicas
- **Alertas de citas** m√©dicas pr√≥ximas
- **Coordinaci√≥n entre cuidadores**

### üìä Base de Datos (Google Sheets)
- **Estructura optimizada** para informaci√≥n m√©dica
- **Hojas especializadas**: Usuarios, Atenciones, Medicamentos, Ex√°menes, Familiares, Recordatorios
- **M√©todos CRUD completos** en `sheets_manager.py`
- **Manejo de errores** de conectividad con Google API
- **Backup autom√°tico** en la nube

### üîß Mejoras de Conectividad
- **Manejo robusto de errores** de red
- **Timeouts configurables** (10s conexi√≥n, 30s lectura)
- **Reintentos autom√°ticos** con backoff exponencial
- **Detecci√≥n de conectividad** a internet
- **Pausas adaptativas** en caso de errores
- **Contador de errores consecutivos**
- **Supervisor de procesos** con reinicio autom√°tico

### üöÄ Despliegue
- **Configuraci√≥n para Railway** con `Procfile` y `railway.json`
- **Variables de entorno** seguras
- **Archivos de configuraci√≥n** completos
- **Documentaci√≥n de despliegue** detallada
- **Gu√≠as paso a paso** para GitHub y Railway

### üìù Documentaci√≥n
- **README.md completo** con gu√≠as de instalaci√≥n
- **DEPLOY_GUIDE.md** con pasos detallados
- **FUNCIONALIDAD_FAMILIA.md** con casos de uso
- **SOLUCION_CONECTIVIDAD.md** con mejoras t√©cnicas
- **Archivos de ejemplo** para configuraci√≥n

### üõ°Ô∏è Seguridad
- **Exclusi√≥n de archivos sensibles** con `.gitignore`
- **Variables de entorno** para credenciales
- **Validaci√≥n de permisos** en operaciones familiares
- **Logs de auditor√≠a** completos
- **Autenticaci√≥n robusta** con Flask

### üîß Archivos de Configuraci√≥n
- `.gitignore` - Exclusi√≥n de archivos sensibles
- `requirements.txt` - Dependencias actualizadas
- `Procfile` - Comandos para Railway
- `railway.json` - Configuraci√≥n avanzada de despliegue
- `env.example` - Ejemplo de variables de entorno
- `LICENSE` - Licencia MIT
- `CHANGELOG.md` - Este archivo

### üìã Estructura del Proyecto
```
medconnect/
‚îú‚îÄ‚îÄ app.py                          # Aplicaci√≥n Flask principal
‚îú‚îÄ‚îÄ bot.py                          # Bot de Telegram con gesti√≥n familiar
‚îú‚îÄ‚îÄ run_bot.py                      # Supervisor del bot
‚îú‚îÄ‚îÄ config.py                       # Configuraci√≥n del proyecto
‚îú‚îÄ‚îÄ auth_manager.py                 # Gesti√≥n de autenticaci√≥n
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sheets_manager.py      # Gesti√≥n completa de Google Sheets
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ flask_api.py           # API REST
‚îÇ   ‚îî‚îÄ‚îÄ bot/
‚îÇ       ‚îú‚îÄ‚îÄ bot_handlers.py        # Manejadores del bot
‚îÇ       ‚îî‚îÄ‚îÄ telegram_bot.py        # Bot alternativo
‚îú‚îÄ‚îÄ static/                         # Recursos est√°ticos
‚îú‚îÄ‚îÄ templates/                      # Plantillas HTML
‚îî‚îÄ‚îÄ docs/                          # Documentaci√≥n
```

### üéØ Casos de Uso Implementados
1. **Familia con madre de tercera edad**:
   - Hijos autorizan diferentes niveles de permisos
   - Reciben notificaciones autom√°ticas de actividad
   - Programan recordatorios de medicamentos
   - Acceden a informaci√≥n m√©dica completa

2. **Cuidador principal**:
   - Gestiona informaci√≥n m√©dica de m√∫ltiples familiares
   - Coordina cuidado entre varios familiares
   - Recibe alertas de citas y medicamentos

3. **Usuario independiente**:
   - Registra su propia informaci√≥n m√©dica
   - Programa recordatorios personales
   - Comparte informaci√≥n selectivamente

### üß™ Testing
- `test_bot_functionality.py` - Pruebas del bot
- `test_integration.py` - Pruebas de integraci√≥n
- `test_multi_files_bot.py` - Pruebas multi-archivo
- Pruebas de conectividad exitosas (3/3)

### üîÑ Pr√≥ximas Versiones
- [ ] App m√≥vil nativa
- [ ] Integraci√≥n con wearables
- [ ] IA para an√°lisis de s√≠ntomas
- [ ] Telemedicina integrada
- [ ] API p√∫blica para desarrolladores

---

## Formato de Versiones

- **[MAJOR.MINOR.PATCH]** - Cambios incompatibles, nuevas funcionalidades, correcciones
- **Agregado** - Nuevas funcionalidades
- **Cambiado** - Cambios en funcionalidades existentes
- **Deprecado** - Funcionalidades que ser√°n removidas
- **Removido** - Funcionalidades removidas
- **Corregido** - Correcci√≥n de errores
- **Seguridad** - Mejoras de seguridad

## [2024-12-28] - Bot con Lenguaje Natural Avanzado

### ü§ñ Mejoras del Bot de Telegram
- **Reconocimiento de intenciones inteligente**: Detecta autom√°ticamente qu√© quiere hacer el usuario
- **8 categor√≠as de intenciones**: consultas, medicamentos, ex√°menes, historial, saludos, despedidas, ayuda, emergencias
- **Sin√≥nimos incluidos**: Reconoce m√∫ltiples formas de expresar la misma intenci√≥n
- **Respuestas conversacionales**: Lenguaje natural, amigable y emp√°tico
- **Variaciones aleatorias**: El bot no repite siempre la misma respuesta
- **Manejo de contexto**: Recuerda el hilo de conversaci√≥n del usuario
- **Detecci√≥n de emergencias**: Respuesta prioritaria con n√∫meros de emergencia
- **Personalizaci√≥n**: Usa el nombre del usuario cuando est√° disponible

### üéØ Ejemplos de Frases que Entiende
- **Consultas**: "Quiero registrar una consulta", "Fui al m√©dico ayer"
- **Medicamentos**: "Necesito anotar un medicamento", "Estoy tomando pastillas"
- **Ex√°menes**: "Me hice unos ex√°menes", "Tengo resultados de laboratorio"
- **Historial**: "Mu√©strame mi historial", "Quiero ver mis datos"
- **Emergencias**: "Tengo dolor fuerte", "Es urgente"

### üõ†Ô∏è Implementaci√≥n T√©cnica
- **Sistema de puntuaci√≥n**: Analiza keywords para detectar intenci√≥n
- **Contexto en memoria**: Almacena estado de conversaci√≥n por usuario
- **Respuestas din√°micas**: 4 variaciones para saludos y mensajes de error
- **Priorizaci√≥n**: Emergencias tienen m√°xima prioridad

### üìö Documentaci√≥n
- **BOT_LENGUAJE_NATURAL.md**: Gu√≠a completa de funcionalidades
- **Ejemplos de conversaci√≥n**: Casos de uso detallados
- **Roadmap futuro**: Pr√≥ximas mejoras planificadas

---

## [2024-12-28] - Sistema de C√≥digos Telegram + Landing Page Modernizada

### ‚ú® Nuevas Funcionalidades
- **Sistema de c√≥digos para vinculaci√≥n Telegram**: Reemplaza el sistema de email por c√≥digos √∫nicos (formato: MED123456)
- **Landing page completamente renovada**: Dise√±o moderno con hero section espectacular
- **Endpoints de diagn√≥stico del bot**: `/test-bot` y `/bot-stats` para monitoreo

### üîß Mejoras
- **Webhook del bot configurado**: Ahora responde mensajes correctamente
- **UI/UX mejorada**: Header transl√∫cido, gradientes consistentes, efectos 3D
- **Responsive design**: Adaptativo para todos los dispositivos
- **Cache busting**: Par√°metro aleatorio para CSS
- **Logging mejorado**: Mejor rastreo de eventos del webhook

### üé® Cambios Visuales
- **Logo prominente**: Utilizaci√≥n del logo.png en header y footer
- **Imagen principal**: Imagen2.png como hero background con overlay
- **6 tarjetas de servicios**: Con iconos circulares y efectos hover
- **Fuente Inter**: De Google Fonts para mejor legibilidad
- **Layout de dos columnas**: Texto + imagen con efectos visuales

### üîó Flujo de Vinculaci√≥n Actualizado
1. Usuario va a perfil web ‚Üí clic "Generar C√≥digo"
2. Sistema genera c√≥digo MED123456 (expira en 15 minutos)
3. Usuario abre @Medconn_bot en Telegram
4. Usuario env√≠a `/codigo MED123456`
5. Bot vincula autom√°ticamente y saluda por nombre

### üõ†Ô∏è Archivos Modificados
- `app.py`: Sistema de c√≥digos, webhook mejorado, endpoints de diagn√≥stico
- `templates/index.html`: Landing page completamente renovada
- `templates/profile.html`: Secci√≥n Telegram actualizada para c√≥digos
- `static/js/profile.js`: Funciones de generaci√≥n y manejo de c√≥digos
- `auth_manager.py`: M√©todo de vinculaci√≥n por user_id
- `test_bot_functionality.py`: Script de diagn√≥stico del bot

### üéØ Estado del Bot
- ‚úÖ Bot de Telegram funcionando y respondiendo mensajes
- ‚úÖ Webhook configurado: `https://www.medconnect.cl/webhook`
- ‚úÖ Bot activo: @Medconn_bot (ID: 7618933472)
- ‚úÖ 4/4 tests exitosos en script de diagn√≥stico

### üì± Comandos del Bot Actualizados
- `/start` - Mensaje de bienvenida con instrucciones de c√≥digos
- `/codigo MED123456` - Vinculaci√≥n por c√≥digo (nuevo)
- `/help` - Ayuda actualizada
- Todos los tips ahora dirigen a la plataforma web 