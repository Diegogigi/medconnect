<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pacientes - MedConnect</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .navbar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }
      .card:hover {
        transform: translateY(-5px);
      }
      .patient-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 25px;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('professional') }}">
          <i class="fas fa-heartbeat me-2"></i>MedConnect
        </a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" href="{{ url_for('professional') }}">
            <i class="fas fa-home me-1"></i>Dashboard
          </a>
          <a class="nav-link active" href="{{ url_for('patients') }}">
            <i class="fas fa-users me-1"></i>Pacientes
          </a>
          <a class="nav-link" href="{{ url_for('consultations') }}">
            <i class="fas fa-stethoscope me-1"></i>Consultas
          </a>
          <a class="nav-link" href="{{ url_for('schedule') }}">
            <i class="fas fa-calendar me-1"></i>Agenda
          </a>
          <a class="nav-link" href="{{ url_for('reports') }}">
            <i class="fas fa-chart-bar me-1"></i>Informes
          </a>
          <a class="nav-link" href="{{ url_for('profile') }}">
            <i class="fas fa-user me-1"></i>Perfil
          </a>
          <a class="nav-link" href="{{ url_for('logout') }}">
            <i class="fas fa-sign-out-alt me-1"></i>Salir
          </a>
        </div>
      </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <h2><i class="fas fa-users me-2"></i>Gestión de Pacientes</h2>
            <button class="btn btn-primary">
              <i class="fas fa-plus me-1"></i>Nuevo Paciente
            </button>
          </div>
        </div>
      </div>

      <!-- Estadísticas -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-primary">{{ pacientes|length }}</h5>
              <p class="card-text">Total Pacientes</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-success">
                {{ pacientes|selectattr('estado_relacion', 'equalto',
                'activo')|list|length }}
              </h5>
              <p class="card-text">Pacientes Activos</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-warning">
                {{ pacientes|selectattr('num_atenciones', 'gt', 0)|list|length
                }}
              </h5>
              <p class="card-text">Con Atenciones</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-info">
                {{ pacientes|selectattr('fecha_primera_consulta',
                'defined')|list|length }}
              </h5>
              <p class="card-text">Con Consultas</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de Pacientes -->
      <div class="row">
        {% for paciente in pacientes %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card patient-card">
            <div class="card-body">
              <div
                class="d-flex justify-content-between align-items-start mb-3"
              >
                <h5 class="card-title">{{ paciente.nombre_completo }}</h5>
                <span class="badge bg-light text-dark"
                  >{{ paciente.estado_relacion|title }}</span
                >
              </div>

              <div class="mb-3">
                <p class="mb-1">
                  <i class="fas fa-id-card me-2"></i>{{ paciente.rut }}
                </p>
                <p class="mb-1">
                  <i class="fas fa-birthday-cake me-2"></i>{{ paciente.edad }}
                  años
                </p>
                {% if paciente.telefono %}
                <p class="mb-1">
                  <i class="fas fa-phone me-2"></i>{{ paciente.telefono }}
                </p>
                {% endif %} {% if paciente.email %}
                <p class="mb-1">
                  <i class="fas fa-envelope me-2"></i>{{ paciente.email }}
                </p>
                {% endif %}
              </div>

              {% if paciente.antecedentes_medicos %}
              <div class="mb-3">
                <small class="text-light">
                  <i class="fas fa-notes-medical me-1"></i>
                  <strong>Antecedentes:</strong> {{
                  paciente.antecedentes_medicos }}
                </small>
              </div>
              {% endif %}

              <div class="d-flex justify-content-between align-items-center">
                <small class="text-light">
                  <i class="fas fa-calendar me-1"></i>
                  {{ paciente.num_atenciones }} atenciones
                </small>
                <div>
                  <button
                    class="btn btn-light btn-sm me-1"
                    title="Ver Detalles"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                  <button class="btn btn-light btn-sm" title="Editar">
                    <i class="fas fa-edit"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Mensaje si no hay pacientes -->
      {% if not pacientes %}
      <div class="row">
        <div class="col-12">
          <div class="card text-center">
            <div class="card-body py-5">
              <i class="fas fa-users fa-3x text-muted mb-3"></i>
              <h4 class="text-muted">No hay pacientes registrados</h4>
              <p class="text-muted">Comienza agregando tu primer paciente</p>
              <button class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Agregar Paciente
              </button>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Funcionalidad básica para los botones
      document.addEventListener("DOMContentLoaded", function () {
        // Botón nuevo paciente
        document.querySelectorAll(".btn-primary").forEach((btn) => {
          if (
            btn.textContent.includes("Nuevo Paciente") ||
            btn.textContent.includes("Agregar Paciente")
          ) {
            btn.addEventListener("click", function () {
              alert("Funcionalidad de nuevo paciente en desarrollo");
            });
          }
        });

        // Botones de acción
        document.querySelectorAll(".btn-light").forEach((btn) => {
          btn.addEventListener("click", function () {
            if (this.querySelector(".fa-eye")) {
              alert("Ver detalles del paciente");
            } else if (this.querySelector(".fa-edit")) {
              alert("Editar paciente");
            }
          });
        });
      });
    </script>
  </body>
</html>
